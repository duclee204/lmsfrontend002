<!-- Payment Modal -->
<div *ngIf="isVisible" class="modal-overlay" (click)="onClose()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">
        <i class="fas fa-credit-card me-2"></i>
        Thanh toán khóa học
      </h3>
      <button type="button" class="btn-close" (click)="onClose()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="modal-body">
      <!-- Course Info -->
      <div *ngIf="course" class="course-info mb-4">
        <div class="course-card">
          <img 
            [src]="course.imageUrl || '/assets/default-course.png'" 
            [alt]="course.title"
            class="course-thumbnail"
          >
          <div class="course-details">
            <h4 class="course-title">{{ course.title }}</h4>
            <p class="course-instructor">Giảng viên: {{ course.instructorName || 'Chưa có thông tin' }}</p>
            <div class="course-price">
              <span class="price-label">Giá khóa học:</span>
              <span class="price-amount">{{ formatCurrency(course.price) }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Payment Methods -->
      <div class="payment-methods mb-4">
        <label class="form-label">Chọn phương thức thanh toán:</label>
        <div class="payment-options">
          <div 
            *ngFor="let method of paymentMethods" 
            class="payment-option"
            [class.selected]="selectedPaymentMethod === method.value"
            (click)="selectedPaymentMethod = method.value"
          >
            <div class="payment-option-content">
              <i [class]="method.icon"></i>
              <span>{{ method.label }}</span>
            </div>
            <div class="payment-option-radio">
              <input 
                type="radio" 
                [value]="method.value" 
                [(ngModel)]="selectedPaymentMethod"
                [id]="'payment-' + method.value"
              >
            </div>
          </div>
        </div>
      </div>

      <!-- VNPay Form -->
      <div *ngIf="selectedPaymentMethod === 'vnpay'" class="vnpay-form mb-4">
        <div class="card border-primary">
          <div class="card-header bg-primary text-white">
            <h5 class="card-title mb-0">
              <i class="fas fa-credit-card me-2"></i>
              Thông tin thanh toán VNPay
            </h5>
          </div>
          <div class="card-body">
            <!-- Payment Amount -->
            <div class="payment-amount">
              <label class="form-label">Số tiền thanh toán:</label>
              <div class="input-group">
                <span class="input-group-text">
                  <i class="fas fa-dollar-sign"></i>
                </span>
                <input 
                  type="text" 
                  class="form-control" 
                  [value]="formatCurrency(course?.price || 0)"
                  readonly
                >
                <span class="input-group-text">VND</span>
              </div>
            </div>

            <!-- Order Info -->
            <div class="mt-3">
              <label class="form-label">Nội dung thanh toán:</label>
              <input 
                type="text" 
                class="form-control" 
                [value]="'Thanh toan khoa hoc: ' + (course?.title || '')"
                readonly
              >
            </div>
          </div>
        </div>
      </div>

      <!-- Error Message -->
      <div *ngIf="errorMessage" class="alert alert-danger">
        <i class="fas fa-exclamation-circle me-2"></i>
        {{ errorMessage }}
      </div>

      <!-- Payment Summary -->
      <div class="payment-summary">
        <div class="summary-row">
          <span>Giá khóa học:</span>
          <span>{{ formatCurrency(course?.price || 0) }}</span>
        </div>
        <div class="summary-row">
          <span>Phí xử lý:</span>
          <span>0 ₫</span>
        </div>
        <hr>
        <div class="summary-row total">
          <span><strong>Tổng cộng:</strong></span>
          <span><strong>{{ formatCurrency(course?.price || 0) }}</strong></span>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button 
        type="button" 
        class="btn btn-secondary me-2" 
        (click)="onClose()"
        [disabled]="isLoading"
      >
        Hủy
      </button>
      <button 
        type="button" 
        class="btn btn-primary" 
        (click)="onPayment()"
        [disabled]="isLoading || !course"
      >
        <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
        <i *ngIf="!isLoading" class="fas fa-credit-card me-2"></i>
        {{ isLoading ? 'Đang xử lý...' : 'Thanh toán ngay' }}
      </button>
    </div>
  </div>
</div>
